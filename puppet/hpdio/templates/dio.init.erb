#!/bin/bash
### BEGIN INIT INFO
# Provides:          dio
# Required-Start:    networking p0f
# Required-Stop:
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Nahazuje dio
### END INIT INFO

NAME="dionaea"

BASE="<%= @install_dir %>"
OPTIONS=""
USER="<%= @dio_user %>"
GROUP="<%= @dio_user %>"
PIDFILE="$BASE/var/$NAME.pid"

cd $BASE
ulimit -c unlimited
ulimit -n 50000

case "$1" in
  start)
        echo -n "Starting $NAME: "
	$0 status 1>/dev/null 2>/dev/null
	if [ $? -eq 0 ]; then
		echo "already running"
		exit 0
	fi
        ${BASE}/bin/dionaea -u $USER -g $GROUP -w ${BASE} -p $PIDFILE -D
        echo "done"
        ;;
  stop)
        echo -n "Stopping $NAME: "
        kill -TERM `cat $PIDFILE`
        echo "done"
        ;;
  force-reload|restart)
        $0 stop
        sleep 10
        $0 start
        ;;
  log)
        tail -f ${BASE}/var/log/dionaea*log
        ;;
  status)
	echo -n "Status of $NAME: "
	pidof ${BASE}/bin/dionaea 1>/dev/null 2>/dev/null
	RET=$?
	if [ $RET -eq 0 ]; then
		echo "running"
	else
		echo "not running"
	fi
	exit $RET
  ;;
  *)
        echo "Usage: $0 {start|stop|restart|force-reload}"
        ps faxu | grep "bin/$NAME"
        exit 1
esac

exit 0
